<div class="bg-transparent rounded-xl p-4">
    <input type="text" id="perm-filter" class="w-full mb-4 px-3 py-2 rounded-lg border border-gray-300 bg-gray-50 text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-400" placeholder="Filtrar permisos...">
    <div id="perm-list"
         class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 max-h-80 overflow-y-auto scrollbar-thin scrollbar-thumb-indigo-200 scrollbar-track-indigo-50 pr-2">
        {% for perm in form.fields.permissions.queryset %}
        <label class="flex flex-col sm:flex-row items-start sm:items-center bg-white px-3 py-2 rounded-lg border border-neutral-200 shadow-sm hover:shadow-md transition w-full perm-item min-w-0">
            <input type="checkbox"
                name="permissions"
                value="{{ perm.id }}"
                class="accent-indigo-500 mb-2 sm:mb-0 sm:mr-2 flex-shrink-0"
                {% if perm in form.initial.permissions or perm in form.cleaned_data.permissions %}checked{% endif %}
            >
            <div class="flex flex-col min-w-0">
                <span class="text-sm font-medium text-neutral-700 truncate max-w-[160px] sm:max-w-none">{{ perm.name }}</span>
                <span class="text-xs text-neutral-400 break-all">{{ perm.codename }}</span>
            </div>
        </label>
        {% endfor %}
    </div>
</div>